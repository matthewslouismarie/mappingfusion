{% extends 'base.html.twig' %}

{% from 'sections/review.html.twig' import review %}
{% from 'sections/article_nav.html.twig' import articleNav %}

{% block resources %}
<link rel="stylesheet" href="https://unpkg.com/@glidejs/glide@3.6.0/dist/css/glide.core.css">
<script src="https://unpkg.com/@glidejs/glide@3.6.0/dist/glide.js"></script>
<script src="{{ app.asset('review-menu.js') }}"></script>
{% endblock %}

{% block title %}{{ article.title }}{% endblock %}

{% block body %}
{# @todo micro data attributes #}
<div class="page-article">
    <div class="std-article">

        <div class="article-cover" style="background-image: url('{{ app.resource(article.cover_filename) }}');">
            <div class="content">
                <div class="_wrapper">
                    <h1 class="title _text -text-xl">{{ article.title }}</h1>
                </div>
            </div>
        </div>

        <div class="columns">
            <div class="nav">
                {{ articleNav(app, article, relatedArticles) }}
            </div>

            <div class="content">
                {% if article.review is defined %}
                <div class="intro _flex -col _gap -gap-row-m _padding -padding-hori-mobile -padding-vert-l2" id="review-intro">
                    <div class="sectioncontent _padding -padding-hori-s _flex -col _gap -gap-row-l">

                        <dl class="std-metadata _text -text-m">
                            <div class="item _flex _gap -gap-col-xs">
                                <dt class="term">Jeu :</dt> <dd class="def">{{ article.review.playable.name }}</dd>
                            </div>
                            <div class="item _flex _gap -gap-col-xs">
                                <dt class="term">Développeur :</dt> <dd class="def">{% for a in authors %}{{ a.name }}{% if not loop.last %}, {% endif %}{% endfor %}</dd>
                            </div>
                            <div class="item _flex _gap -gap-col-xs">
                                <dt class="term">Date de sortie :</dt> <dd class="def">{{ article.review.playable.release_date_time|date('Y') }}</dd>
                            </div>
                        </dl>

                        <p class="_text -text-s">{{ article.review.body }}</p>

                        {{ review(app.mk, article.review.playable, article.review) }}
                    </div>
                </div>
                {% endif %}

                <div class="sectioncontent _padding -padding-hori-s -padding-vert-l" id="article-body">
                    <div class="std-markdown-container">
                        {{ app.mk.format(article.body)|raw }}
                    </div>
                </div>

                {% if app.getImages(article.body) %}
                <div class="glide -arrows _padding -padding-vert-l -padding-s" id="article-images">
                    <div class="controls" data-glide-el="controls">
                        <button class="button -left" data-glide-dir="<"></button>
                    </div>
                    <div class="glide__track" data-glide-el="track">
                        <ul class="glide__slides">
                            {% for i in app.getImages(article.body) %}
                            <li class="glide__slide">
                                <a class="link" href="{{ app.resource(i) }}" style="background-image: url({{ app.resource(i) }});"></a>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div class="controls" data-glide-el="controls">
                        <button class="button -right" data-glide-dir=">"></button>
                    </div>
                </div>
                {% endif %}

                {% if article.review is defined %}
                <div class="sectioncontent _padding -padding-hori-s -padding-vert-l" id="review-summary">
                    {{ review(app.mk, article.review.playable, article.review, '-summary') }}
                </div>
                {% endif %}

                <div class="sectioncontent _padding -padding-hori-s -padding-vert-l">
                    <aside class="article-advice _flex _gap -gap-col-s _padding -padding-s">
                    {# @todo Should be a background #}
                        <img class="img" {{ app.imgAttr('Le conseil Mapping-Fusion', 'mapping-fusion-advice.svg', false, 125, 106)|raw }}>
                        <div class="text _flex -col _gap -gap-row-s">
                            <h2 class="heading _text -text-l">Le petit conseil pour les mappeurs de Mapping Fusion</h2>
                            <p class="text _text -text-m">Le level design et l’éclairage étant très réussi, nous vous recommandons de jouer à ce MOD qui reste un très bonne source d’inspiration pour créer vos maps ! (structure, type de textures, mis en lumière etc...)</p>
                        </div>
                    </aside>
                </div>
            </div>
        </div>
    </div>

    {% include 'sections/social-medias-all.html.twig' %}

    {% include 'sections/beginners-all.html.twig' %}
</div>
{% endblock %}

{% block scriptInit %}
<script>
    {% if app.getImages(article.body) %}
    const glide = new Glide('.glide', {gap: 0});
    glide.on('mount.after', function () {
        glide.update();
    });
    glide.mount();
    {% endif %}

    const reviewMenu = new ReviewMenu();
    reviewMenu.init();
</script>
{% endblock %}